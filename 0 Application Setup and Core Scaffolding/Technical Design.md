## üß† Technical Summary

Develop a web-based internal business tool for agentic PDF data extraction using a React frontend and a Python FastAPI backend. Users upload PDFs which are processed by the landing.ai Python SDK through a two-step workflow involving parse and extract endpoints. The system dynamically builds Pydantic schemas based on user-selected fields during parsing, renders extracted data as tables, and supports exporting results as CSV and Markdown. A dual-pane review interface shows the original PDF alongside extracted Markdown, complemented by a chat interface enabling human-in-the-loop interaction. Data and PDFs are stored locally on the server filesystem with metadata persisted in a SQLite database.

## üß± Architecture Decisions

|   |   |   |
|---|---|---|
|Component|Decision|Rationale|
|Frontend framework|React|Popular, flexible, and well-suited for building interactive UIs with chat and review panes|
|Backend framework|FastAPI (Python)|Async, performant, ideal for API development and native integration with landing.ai SDK|
|Communication|REST API|Simple, well-understood, sufficient for upload, extraction, review, and chat flows|
|Storage|Local filesystem + SQLite|Simplifies MVP deployment and development; SQLite is lightweight and easy to manage|
|PDF processing|landing.ai Python SDK|Native SDK integration with parse and extract endpoints for agentic extraction|
|Schema validation|Pydantic (dynamic schema generation)|Enables runtime schema creation based on user-selected fields during parse step|
|Data export|Backend-generated CSV and Markdown|Backend handles export formats for consistency and ease of download|
|PDF Rendering|PDF.js or similar React wrapper|Enables in-browser PDF display for review pane|
|Markdown Rendering|React Markdown libraries|For clean display of extracted content|
|Authentication|Basic internal auth (if needed)|MVP focus on internal users, simple auth mechanisms|

## üß∞ Framework & Library Decisions

|   |   |   |
|---|---|---|
|Component|Chosen Tool|Rationale|
|Frontend|React|Component-based UI, large ecosystem, easy integration with REST APIs|
|Backend|FastAPI|Async Python framework, excellent for API development and SDK integration|
|PDF Extraction SDK|landing.ai Python SDK|Provides agentic extraction capabilities with parse and extract endpoints|
|Database|SQLite|Lightweight, file-based DB suitable for MVP and local storage|
|PDF Rendering|PDF.js or React wrapper|Enables in-browser PDF display for review pane|
|Markdown Rendering|React Markdown libraries|For clean display of extracted content|
|Validation|Pydantic|Dynamic schema generation and validation based on user input|
|Export|Python CSV and Markdown libraries|Backend generates CSV and Markdown exports|

## üß© Key Components

- ****PDF Upload API**** ‚Äì Accepts PDFs (max 50MB), stores files locally, triggers extraction workflow
- ****Parse Endpoint Integration**** ‚Äì Calls landing.ai parse endpoint to identify extractable fields, presents these to users for selection
- ****Dynamic Schema Builder**** ‚Äì Generates Pydantic schemas at runtime based on user-selected fields from parse results
- ****Extract Endpoint Integration**** ‚Äì Uses landing.ai extract endpoint with generated schema to extract structured data
- ****Data Rendering**** ‚Äì Renders extracted data as tables in the UI, supports export as CSV and Markdown generated by backend
- ****Review UI**** ‚Äì Dual-pane React interface showing original PDF and extracted Markdown side-by-side
- ****Approval Workflow**** ‚Äì UI controls for approve, reject, escalate with sidebar navigation
- ****Chat Interface**** ‚Äì React chat component querying backend to answer questions referencing PDF content with highlights
- ****Data Storage**** ‚Äì Local filesystem for PDFs, SQLite for metadata and extracted text
- ****Security Layer**** ‚Äì Encryption at rest and in transit, GDPR compliance with data deletion endpoints

## üìê API Design

|   |   |   |
|---|---|---|
|Method|Endpoint|Description|
|POST|`/api/upload`|Upload PDF file, returns document ID|
|GET|`/api/documents/{id}`|Fetch document metadata and extraction status|
|GET|`/api/documents/{id}/pdf`|Stream original PDF for review pane|
|GET|`/api/documents/{id}/markdown`|Fetch extracted Markdown content|
|POST|`/api/documents/{id}/parse`|Call landing.ai parse endpoint, return fields for user selection|
|POST|`/api/documents/{id}/extract`|Call landing.ai extract endpoint with user schema, store results|
|POST|`/api/documents/{id}/approve`|Approve document extraction result|
|POST|`/api/documents/{id}/reject`|Reject document extraction result|
|POST|`/api/documents/{id}/escalate`|Escalate document for further review|
|POST|`/api/documents/{id}/chat`|Send chat query, returns AI agent response|
|GET|`/api/documents/{id}/export/csv`|Download extracted data as CSV file|
|GET|`/api/documents/{id}/export/md`|Download extracted data as Markdown file|

## üìä Schema Changes

### Table: `documents`

|   |   |   |
|---|---|---|
|Column|Type|Description|
|`id`|INTEGER PK|Unique document identifier|
|`filename`|TEXT|Original filename|
|`filepath`|TEXT|Local path to stored PDF|
|`status`|TEXT|Extraction status (pending, approved, rejected, escalated)|
|`extracted_md`|TEXT|Extracted Markdown content|
|`uploaded_at`|TIMESTAMP|Upload timestamp|
|`processed_at`|TIMESTAMP|Extraction completion timestamp|

### Table: `chat_logs`

|   |   |   |
|---|---|---|
|Column|Type|Description|
|`id`|INTEGER PK|Unique chat log entry|
|`document_id`|INTEGER FK|Associated document|
|`query`|TEXT|User's chat query|
|`response`|TEXT|AI agent's response|
|`created_at`|TIMESTAMP|Timestamp of chat interaction|

## üìã Integration with landing.ai Python SDK

- ****Parse Endpoint Usage****
- Call `parse` endpoint with uploaded PDF to identify extractable fields and data structure.
- Present parsed fields to users in UI for selection of which fields to extract.
- Example snippet:

    from landingai import Client    
    client = Client(api_key="YOUR_API_KEY")    
    parse_response = client.parse_document(file_path="path/to/pdf")    
    fields = parse_response.fields  # List of detected fields    
    ```    
  
- **Dynamic Pydantic Schema Generation**    
  - Based on user-selected fields, dynamically generate Pydantic models to validate extracted data.    
  - Example approach:    
    ```python  
    from pydantic import BaseModel, create_model    
    def generate_schema(selected_fields):    
        fields = {field_name: (str, ...) for field_name in selected_fields}    
        return create_model('DynamicSchema', **fields)    
    ```    
  
- **Extract Endpoint Usage**    
  - Use generated schema to call `extract` endpoint, passing structured schema and PDF.    
  - Extracted data is validated against the dynamic schema.    
  - Example snippet:    
    ```python  
    extract_response = client.extract_document(file_path="path/to/pdf", schema=generated_schema)    
    extracted_data = extract_response.data    
    ```    
  
- **Data Rendering and Export**    
  - Extracted data is rendered as tables in the frontend.    
  - Backend generates CSV and Markdown exports using standard Python libraries (`csv`, `markdown`).    
  - Export endpoints serve these files for download.  
  
## ‚ö†Ô∏è Edge Cases & Handling  
  
| Edge Case                          | Expected Behavior                          | Handling Strategy                                  |  
|-----------------------------------|--------------------------------------------|---------------------------------------------------|  
| PDF upload exceeds 50MB            | Reject upload with error message            | Enforce max file size limit on frontend and backend |  
| Extraction failure or SDK error    | Mark document as failed, notify user       | Log error, allow reprocessing or escalation       |  
| Concurrent uploads                 | Handle via async processing queue           | Use FastAPI async features, queue extraction jobs  |  
| User rejects extraction           | Mark document rejected, disable chat        | Prevent further interaction until re-upload       |  
| Chat query references missing data| Return fallback response, prompt user       | Validate context, fallback to generic answer       |  
| Data deletion request             | Remove PDFs and DB entries securely          | Implement GDPR-compliant deletion endpoint          |  
  
## üîí Security & Scalability Considerations  
  
### Security  
  
- Encrypt PDFs and extracted data at rest on server filesystem and in SQLite    
- Use HTTPS for all API communication    
- Restrict access to internal users via authentication (MVP: basic auth or token-based)    
- Sanitize all user inputs to prevent injection attacks    
- GDPR compliance with data deletion and audit logging    
  
### Scalability  
  
- MVP targets local storage and SQLite; future plans to migrate to cloud storage and scalable DB    
- Async extraction jobs to prevent blocking API requests    
- Frontend optimized for dense layout and fast rendering    
- Modular backend design to allow horizontal scaling and microservice extraction if needed